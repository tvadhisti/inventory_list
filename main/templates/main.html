{% extends 'base.html' %}

{% block content %}


<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td,
        th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;

        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }

        .logout-btn {
            border-radius: 5px;
            background-color: transparent;
            border: #3463ad;
            color: white;
            display: flex;
            margin: auto;
            justify-content: center;
            align-items: center;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 20px;

        }

        .new-btn {
            border-radius: 5px;
            background-color: #3463ad;
            border: #3463ad;
            color: white;
            display: flex;
            margin: auto;
            justify-content: center;
            align-items: center;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 15px;
            margin-top: 20px;
        }

        .new-btn:hover {
            background-color: #3b70c4;
            border: #3b70c4;
            cursor: pointer;
        }

        .delete-btn {
            border-radius: 5px;
            /* background-color: red;
            border: red; */
            color: rgb(0, 0, 0);
            display: flex;
            margin: auto;
            justify-content: center;
            align-items: center;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 15px;
            background-color: #fdfeff6f;
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
        }

        a {
            text-decoration: none;
        }

        .header {
            position: fixed;
            width: 100%;
            padding: 10px 25px;
            /* background-color: blue; */
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            color: white;
            background-color: rgb(31, 45, 112);
        }

        .logout-btn:hover {
            color: #e4e8ee;
        }

        .card-name {
            width: 250px;
            height: 30px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            align-content: center;
            padding-top: 10px;
            border: 2px solid black;
            margin-left: 10px;
            margin-bottom: 10px;

        }

        .card-table {
            background-color: white;
            border-radius: 10px;
            box-shadow: 10px 16px 40px 10px rgba(112, 144, 176, 0.20);
            padding: 20px;
            margin: 20px;

        }

        .side-nav {
            width: 250px;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            padding: 30px 15px;
            background-color: white;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size: 20px;

        }

        .side-item {
            padding: 10px;
        }

        .side-item:hover {
            background: #3463ad;
            padding: 10px;
            border-radius: 10px;
            color: white;
        }

        a {
            text-decoration: none;
            color: black;
            font-size: 20px;

        }

        a:hover {
            color: #3463ad;
        }

        .card-item {
            background-color: #b4d2ff;
            color: rgb(38, 111, 213);
            padding: 20px;
            width: 370px;
            border-radius: 10px;
            box-shadow: 0px 16px 15px 0px rgba(112, 144, 176, 0.20);
            margin: 20px;

        }
    </style>
</head>



<div class="container-fluid " style="padding: 0px;">
    <div class="row content">
        <div class="col-sm-2 sidenav hidden-xs" style="height: 100vh;">
            <h2 style="text-align: center; padding-top: 20px; font-size: 40px;">InVentory</h2>
            <hr style="margin-left: 15px;">
            <br>
            <div style="margin-left: 20px;">
                <img width="20px" style="padding-bottom: 5px;"
                    src="https://cdn-icons-png.flaticon.com/128/3757/3757985.png">
                <a style=" padding-left: 10px; " href="/">Dashboard</a></li>
            </div>
            <br>
            <div style="margin-left: 20px;">
                <img width="20px" style="padding-bottom: 5px; position: fixed; bottom: 30px; left: 30px;"
                    src="https://cdn-icons-png.flaticon.com/128/2099/2099238.png">
                <a style="position: fixed; bottom: 30px; padding-left: 40px;" href="{% url 'main:logout' %}">
                    Logout

                </a>
            </div>
        </div>
        <br>

        <div class="col-sm-10" style="background: #f3f4f4; height: 100vh;">
            <div class="well">

                <h5 style="font-size: 25px; margin-bottom: 10px; font-weight: 600; margin: 20px;">
                    Welcome Back, {{name}}!
                </h5>

                <div class="card-item" id="item-count">
                    <b id="item-count"
                        style="color: rgb(38, 111, 213); font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; padding: 0px; margin: 0px;">
                        You have saved {{items_count}} items in this
                        application</b>
                </div>
                <!-- <h5 style="margin-top: 0px; text-align: center;">
                    {{class}}
                </h5> -->

                <!DOCTYPE html>
                <html>
                <div class="card-table">
                    <table id="product_table"></table>
                </div>
                <!-- <div class="card-table">

                    <table>
                        <tr>
                            <th>Name</th>
                            <th>Amount</th>
                            <th>Description</th>
                            <th> Date Added</th>
                        </tr>

                        {% comment %} Below is how to show the product data {% endcomment %}

                        {% for item in items %}
                        <tr>
                            <td>{{item.name}}</td>
                            <td>{{item.amount}}</td>
                            <td>{{item.description}}</td>
                            <td>{{item.date_added}}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div> -->

                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Add New Product</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="form" onsubmit="return false;">
                                    {% csrf_token %}
                                    <div class="mb-3">
                                        <label for="name" class="col-form-label">Name:</label>
                                        <input type="text" class="form-control" id="name" name="name"></input>
                                    </div>
                                    <div class="mb-3">
                                        <label for="amount" class="col-form-label">Amount:</label>
                                        <input type="number" class="form-control" id="amount" name="amount"></input>
                                    </div>
                                    <div class="mb-3">
                                        <label for="description" class="col-form-label">Description:</label>
                                        <textarea class="form-control" id="description" name="description"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="button_add"
                                    data-bs-dismiss="modal">Add
                                    Item</button>
                            </div>
                        </div>
                    </div>
                </div>


                <button type="button" class="new-btn" data-bs-toggle="modal" data-bs-target="#exampleModal">Add
                    New Item</button>
                <!-- <div>
                    <a href="{% url 'main:create_product' %}">
                        <button class="new-btn">
                            Add New Product
                        </button>
                    </a>
                </div> -->

                <h5 style="padding-left: 15px; font-size: 15px; margin: 20px;">Last login session: {{ last_login }}</h5>

            </div>
        </div>
    </div>

    <script>
        async function getProducts() {
            return fetch("{% url 'main:get_product_json' %}").then((res) => res.json())
        }


        async function refreshProducts() {

            document.getElementById("product_table").innerHTML = ""
            const products = await getProducts()
            let htmlString =
                `<tr>
            <th>Name</th>
            <th>Amount</th>
            <th>Description</th>
            <th>Date Added</th>
            <th>Action</th>
        </tr>`
            products.forEach((item) => {
                htmlString += `\n<tr>
            <td>${item.fields.name}</td>
            <td>${item.fields.amount}</td>
            <td>${item.fields.description}</td>
            <td>${item.fields.date_added}</td>
            <td>
                <button class="delete-btn" onclick="deleteProduct(${item.pk})">
            Delete
        </button>
        </td>

        </tr>`
            })

            document.getElementById("product_table").innerHTML = htmlString
        }

        refreshProducts()

        function addProduct() {
            fetch("{% url 'main:add_product_ajax' %}", {
                method: "POST",
                body: new FormData(document.querySelector('#form'))
            }).then(refreshProducts)

            document.getElementById("form").reset()
            return false
        }

        document.getElementById("button_add").onclick = addProduct

        function deleteProduct(id) {
            fetch("delete-product-ajax/" + id, {
                method: "POST"
            }).then(refreshProducts)

            document.getElementById("form").reset()
            return false
        }

    </script>

    {% endblock content %}